<script>
    window.processData = function (epics, ignoreEmpty) {
        console.log('data in', epics);
        var retval = [];

        var storyWeight = 2;
        var subtaskWeight = 1;

        epics.forEach(function (epic) {
            var storyPointSum = 0;
            var tasksTotal = 0;
            var tasksDone = 0;
            var timeSpent = 0;
            var percentage = 0;

            epic.children.forEach(function (story) {
                if (story.sp) {
                    storyPointSum += story.sp;
                }
                if (story.aggregateTimeSpent) {
                    timeSpent += story.aggregateTimeSpent;
                }

                tasksTotal += storyWeight;
                if (epic.closed || story.closed) {
                    tasksDone += storyWeight;
                }

                if (story.children) {
                    story.children.forEach(function (subtask) {
                        tasksTotal += subtaskWeight;
                        if (epic.closed || story.closed || subtask.closed) {
                            tasksDone += subtaskWeight;
                        }
                    });
                }
            });
            if (epic.aggregateTimeSpent) {
                timeSpent += epic.aggregateTimeSpent;
            }
            if (storyPointSum === 0) {
                percentage = 0;
            } else {
                percentage = tasksDone / tasksTotal;
            }

            if (!(ignoreEmpty && storyPointSum === 0)) {
                retval.push([epic.summary, storyPointSum, storyPointSum * percentage, timeSpent / 3600 / 8.4]);
            }
        });
        console.log("epics", retval.length, retval);
        return retval;
    };
</script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/q.js/1.4.1/q.min.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://raw.githack.com/brookman/jira/2b834eb1c6ba21d0b699962c43c5c8430e799dc9/src/js/jira-utils.js"></script>
<script src="https://rawgit.com/brookman/jira/2b834eb1c6ba21d0b699962c43c5c8430e799dc9/src/js/project-overview.js"></script>
<div><textarea id="epicsJson">
[]
</textarea>
    <input id="releaseVersionInputText" type="text" value="2016.11 C"/>
    <button id="loadDataButton">Load data from JIRA</button>
    <br/>
    <input id="ignoreEmptyEpicsCheckbox" type="checkbox">Ignore epics without story points</input>
    <button id="generateChartButton">Generate chart</button>
</div>
<div id="overview_epics_chart"></div>
<div id="overview_epics"></div>